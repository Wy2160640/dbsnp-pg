---
- name: configure sshd
  lineinfile: >
    dest=/etc/ssh/sshd_config
    owner=root group=root mode=0600 backup=yes
    regexp="{{ item.regexp }}"
    line="{{ item.line }}"
    insertafter="{{ item.insertafter }}"
  with_items:
    - regexp: '^PermitRootLogin'
      line: 'PermitRootLogin no'
      insertafter: '#PermitRootLogin'
    - regexp: '^PubkeyAuthentication'
      line: 'PubkeyAuthentication yes'
      insertafter: '#PubkeyAuthentication'
    - regexp: '^PasswordAuthentication'
      line: 'PasswordAuthentication no'
      insertafter: '#PasswordAuthentication'
    - regexp: '^ChallengeResponseAuthentication'
      line: 'ChallengeResponseAuthentication no'
      insertafter: '#ChallengeResponseAuthentication'
    - regexp: '^GSSAPIAuthentication'
      line: 'GSSAPIAuthentication no'
      insertafter: '#GSSAPIAuthentication'
  notify: restart sshd
  tags: sshd